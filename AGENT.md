# AGENT.md — YT Live Translator (Windows / Chrome / Local)

## 0. このリポジトリで達成すること（最優先）
YouTube（字幕有無問わず）の動画音声を入力として、英語→日本語の同時通訳を行い、
- 英語（原文）＋日本語（翻訳）を **リアルタイム表示**
- **停止ボタン**で停止可能
- 翻訳確定結果を **履歴ログとして蓄積**
する Windows ローカル実行システムを実装する。

対象用途：PCツールのチュートリアル動画
要件：技術/ツール用語は不用意に翻訳しない（辞書・ルール・プロンプト等で制御）。

---

## 1. エージェントの責務
### 1.1 実装責務
- Desktop（UI）を中心に、システム全体を動作する状態まで仕上げる
- ASR（音声→英語テキスト）＋翻訳（英→日）＋字幕表示の統合
- 例外/停止/状態表示/UI操作性の確立
- 将来拡張の下地（履歴保存/全編翻訳）を実装しやすい形に保つ

### 1.2 Git管理責務
- 以降の変更はすべて Git 管理（コミット/PR相当の粒度を維持）
- ビルド生成物の混入防止（bin/obj/dist/node_modules 等は追跡しない）
- 変更の意図が追えるコミットメッセージ（日本語でOK）

---

## 2. 非機能要件（重要）
- Windows 11 で完結（WSL/Docker 不使用）
- Chrome 使用前提（Manifest V3）
- ネイティブ起動は exe 形式
- システムはローカル動作（ネットワーク依存は許容するが、将来ローカル完結の可能性を残す）
- UIは別ウィンドウ（オーバーレイ可）。Chromeへ「描画ループバック」は必須ではない。

---

## 3. 仕様（ユーザー体験としての確定要件）
### 3.1 操作フロー
1) システム起動（Desktop UI）
2) Chromeタブ選択（YouTubeタブである必要あり）
3) 「翻訳開始」押下 → 待機状態
4) 動画再生開始で自動的に翻訳/字幕表示
5) 「停止」押下で停止（処理停止・UI停止・必要なら接続解放）

### 3.2 タブ選択制約
- YouTube以外のタブを選択した場合：
  - 開始ボタン非活性
  - 状態表示（1行領域）にエラーメッセージを出す

### 3.3 字幕表示
- 2言語同時表示（英語＋日本語）
- リアルタイムに追従（遅延は許容だが、途切れ/暴走を避ける）
- オーバーレイ表示は Desktop で行ってよい（別ウィンドウ）

### 3.4 翻訳履歴
- 画面表示（オーバーレイ）はリアルタイム更新
- アプリ側では「確定した翻訳結果」をログとして積む（UIに一覧表示）
- 履歴は当面メモリ保持でOK（将来保存機能へ拡張）

### 3.5 技術用語の翻訳抑制
- チュートリアル用途のため、プロダクト名/機能名/API名/ショートカット/専門用語を勝手に和訳しない
- 具体案：
  - 固有名詞辞書（keep list）＋変換禁止ルール
  - 翻訳モデル/プロンプトに「固有名詞/コード/メニュー項目は原文維持」指示
  - 英文を括弧で残す/併記する等（UI/ログ仕様に反映）

---

## 4. 構成（現在のアーキテクチャ方針）
- Chrome拡張：タブ判定・制御・（可能なら）音声キャプチャ起点
- NativeHost：Chrome Native Messaging で Desktop/処理系と橋渡し
- Desktop（Avalonia）：UI・状態表示・ログ表示・字幕オーバーレイ表示・開始/停止制御
- ASR/翻訳：差し替え可能なモジュールとして実装（ローカル完結は将来検討）

重要：NativeHost は「安定稼働」優先。複雑なUI/処理を詰め込まない。

---

## 5. これからの開発段階（実装ロードマップ）
### Phase 1: UI骨格確立（Desktop）
- 上部に状態表示1行（info/error）
- 開始/停止ボタン
- 翻訳履歴ログ一覧ペイン（原文/訳文/時刻/将来の秒数）
- オーバーレイ用字幕ビュー（英/日二段）

受け入れ条件：
- UI単体で起動し、開始/停止が状態遷移する（処理未接続でも良い）

### Phase 2: Chromeタブ選択とYouTube判定
- 拡張側で現在タブURLを取得し、YouTube判定
- YouTube以外なら開始不可＋状態表示
- Desktopが現在状態を表示できるようにメッセージ仕様を固める

受け入れ条件：
- YouTubeタブ時のみ開始が有効化
- それ以外はエラー表示＋開始無効

### Phase 3: 音声入力（字幕無し動画対応の核心）
要件上「字幕が無い動画でも翻訳」＝音声からASR必須。

候補（優先度順はエージェント判断）：
- ChromeのtabCapture / captureStream（制約/権限/扱い確認）
- OSループバック（WASAPI）をネイティブ側で取得（Windows前提で強い）
- 代替：ユーザーが入力デバイスを仮想ミキサ等に変える（ただし“ユーザー側に特別操作を要求しない”が望ましい）

受け入れ条件：
- YouTube再生音がASRに入力され、英語テキストが継続的に得られる

### Phase 4: ASR（英語テキスト化）
- ストリーミング対応（部分結果→確定結果）
- 確定単位の切り方（文/句/時間）を定義
- 低遅延より「途切れない」ことを優先

受け入れ条件：
- 連続した英語テキスト（部分/確定）が得られる
- 停止で確実に止まる

### Phase 5: 翻訳（英→日）＋用語保護
- 用語保護辞書/ルールを適用
- UI表示はリアルタイム（部分翻訳可）
- 履歴ログは「確定翻訳」だけ積む

受け入れ条件：
- 英語/日本語が同時表示される
- 履歴ログが増えていく
- 用語が勝手に崩れない

### Phas
